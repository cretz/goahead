
// Don't need the running rt.jar because we are supplying it
exclude-running-runtime-jar = true

// Prepend the statement that we use a redistributable OpenJDK JAR as our source
prepend-to-file =
  "// Generated from Azul Zulu packaged OpenJDK JAR and carries the same GPL license with the classpath exception"

class-path = [
  ${ZULU_JDK_HOME}/jmods/java.base.jmod
]

// Put in rt which automatically gives "rt" as the package name
out-dir = libs/java/rt

//parallel = true

// On Windows, this breaks; see https://github.com/golang/go/issues/18468
// file-grouping = "class"
file-grouping = "first-packages-4"

any-class-modifiers = [ public, protected, package-private ]
classes = [
  "java.io.?"
  "java.lang.?"
  "java.lang.invoke.?"
  "java.util.?"
  "java.util.function.BiConsumer"
  "java.util.function.BinaryOperator"
  "java.util.function.IntFunction"
  "java.util.function.Function"
  "java.util.stream.Stream"
]

include-all-referenced = [
  {
    priority = -301
    method-filter { body-references-excluded-class = true }
    methods { "*" = [{ exclude = false }, { panic = true }] }
  }
  {
    priority = -302
    fields { "*" { exclude = false } }
    methods { "*" = [{ exclude = false }, { as-is = true }] }
  }
]

class-manips {
  "java.io.BufferedWriter" = ${include-all-referenced}
  "java.io.FilterOutputStream" = ${include-all-referenced}
  "java.io.OutputStream" = ${include-all-referenced}
  "java.io.OutputStreamWriter" = ${include-all-referenced}
  "java.io.PrintStream" = ${include-all-referenced}
  "java.io.Writer" = ${include-all-referenced}

  "java.lang.String" {
    fields {
      Underlying { go = JString }
    }
  }

  "java.lang.StringBuilder" {
    fields {
      Underlying { go = JString }
    }
  }

  "java.lang.System" {
    methods {
      "<clinit>" { go = System_StaticInit }
    }
  }

  "*" = [
    // Empty all inits
    {
      priority = -200
      method-filter = { any-modifiers = [ public, protected ] }
      methods { "<init>" { empty = true } }
    }
    {
      priority = -200
      methods { "<clinit>" { empty = true } }
    }
    {
      priority = -200
      methods { "<clinit>" { exclude = false } }
    }

    // Only fields and methods that reference classes we know
    {
      priority = -300
      field-filter { references-excluded-class = true }
      fields { "*" { exclude = true } }
      method-filter { signature-references-excluded-class = true }
      methods { "*" { exclude = true } }
    }

    // Exclude all private fields and all private methods
    {
      priority = -400
      field-filter { any-modifiers = [ private, package-private ] }
      fields { "*" { exclude = true } }
      method-filter { any-modifiers = [ private, package-private ] }
      methods { "*" { exclude = true } }
    }

    // Panic all method impls
    {
      priority = -500
      methods { "*" { panic = true } }
    }
  ]
}